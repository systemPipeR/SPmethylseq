<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Methyl-Seq Workflow Template • systemPipeMethylseq</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Methyl-Seq Workflow Template">
<meta property="og:description" content="systemPipeMethylseq">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-158796879-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-158796879-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">systemPipeMethylseq</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.9.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/systemPipeMethylseq.html">
    <span class="fas fa fas fa-book"></span>
     
    Workflow
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/systemPipeR/systemPipeMethylseq">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Methyl-Seq Workflow Template</h1>
                        <h4 class="author">Author: Daniela Cassol (<a href="mailto:danielac@ucr.edu" class="email">danielac@ucr.edu</a>) and Thomas Girke (<a href="mailto:thomas.girke@ucr.edu" class="email">thomas.girke@ucr.edu</a>)</h4>
            
            <h4 class="date">Last update: 29 April, 2020</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/systemPipeR/systemPipeMethylseq/blob/master/vignettes/systemPipeMethylseq.Rmd"><code>vignettes/systemPipeMethylseq.Rmd</code></a></small>
      <div class="hidden name"><code>systemPipeMethylseq.Rmd</code></div>

    </div>

    
    
<style type="text/css">
pre code {
white-space: pre !important;
overflow-x: scroll !important;
word-break: keep-all !important;
word-wrap: initial !important;
}
</style>
<!--
## Compile from command-line
Rscript -e "rmarkdown::render('systemPipeMethylseq.Rmd', c('BiocStyle::html_document'), clean=F); knitr::knit('systemPipeMethylseq.Rmd', tangle=TRUE)"; Rscript ../md2jekyll.R systemPipeMethylseq.knit.md 2; Rscript -e "rmarkdown::render('systemPipeMethylseq.Rmd', c('BiocStyle::pdf_document'))" --><script type="text/javascript">
document.addEventListener("DOMContentLoaded", function() {
  document.querySelector("h1").className = "title";
});
</script><script type="text/javascript">
document.addEventListener("DOMContentLoaded", function() {
  var links = document.links;  
  for (var i = 0, linksLength = links.length; i < linksLength; i++)
    if (links[i].hostname != window.location.hostname)
      links[i].target = '_blank';
});
</script><div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>Users want to provide here background information about the design of their Methyl-Seq project.</p>
<p>Cytosine methylation is one of the important epigenetic mechanism to control gene expression. The epigenetic modification is has been associated with many biological processes, including various diseases and normal development, as well. One of the techniques for profiling genome-wide DNA methylation is based on sodium bisulfite, followed by NGS (BS-seq). Whole-genome bisulfite sequencing (WGBS) provides global coverage at a single-base resolution. This protocol effectively converts on-methylated cytosines into uracils, while methylated cytosines are preserved. Eventually, uracils are converts into thymines during the PCR amplification cycles.</p>
<!-- Add some introduction about the sequencing protocol... -->
</div>
<div id="sample-definitions-and-environment-settings" class="section level1">
<h1 class="hasAnchor">
<a href="#sample-definitions-and-environment-settings" class="anchor"></a>Sample definitions and environment settings</h1>
<div id="environment-settings-and-input-data" class="section level2">
<h2 class="hasAnchor">
<a href="#environment-settings-and-input-data" class="anchor"></a>Environment settings and input data</h2>
<p>Typically, the user wants to record here the sources and versions of the reference genome sequence along with the corresponding annotations. In the provided sample data set all data inputs are stored in a <code>data</code> subdirectory and all results will be written to a separate <code>results</code> directory, while the <code>systemPipeMethylseq.Rmd</code> script and the <code>targets</code> file are expected to be located in the parent directory. The R session is expected to run from this parent directory.</p>
<p>The chosen data set <a href="https://www.ncbi.nlm.nih.gov/sra/?term=SRP097911">SRP097911</a> contains single-end (SE) read sets from <em>Arabidposis thaliana</em> <span class="citation">(Ganguly et al. 2017)</span>.</p>
<!--
TODO: remover this part and add the new explain form the new genWorkenvir function)
-->
<p>The following loads one of the available NGS workflow templates (here Methyl-Seq) into the user’s current working directory. At the moment, the package includes workflow templates for RNA-Seq, ChIP-Seq, VAR-Seq, Ribo-Seq and Methyl-Seq. Templates for additional NGS applications will be provided in the future.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">systemPipeRdata</span>)
<span class="fu"><a href="https://rdrr.io/pkg/systemPipeRdata/man/genWorkenvir.html">genWorkenvir</a></span>(<span class="kw">workflow</span> <span class="kw">=</span> <span class="kw">NULL</span>, <span class="kw">package_repo</span> <span class="kw">=</span> <span class="st">"systemPipeR/systemPipeMethylseq"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">setwd</a></span>(<span class="st">"systemPipeMethylseq"</span>)</pre></body></html></div>
<p>Now open the R markdown script <code>systemPipeMethylseq.Rmd</code>in your R IDE (<em>e.g.</em> vim-r or RStudio) and run the workflow as outlined below.</p>
</div>
<div id="required-packages-and-resources" class="section level2">
<h2 class="hasAnchor">
<a href="#required-packages-and-resources" class="anchor"></a>Required packages and resources</h2>
<p>The <code>systemPipeR</code> package needs to be loaded to perform the analysis steps shown in this report <span class="citation">(Girke 2014)</span>. <!--
TODO: add new package dependence in the Description, and namespace
--></p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">systemPipeR</span>)</pre></body></html></div>
</div>
<div id="experiment-definition-provided-by-targets-file" class="section level2">
<h2 class="hasAnchor">
<a href="#experiment-definition-provided-by-targets-file" class="anchor"></a>Experiment definition provided by <code>targets</code> file</h2>
<p>The <code>targets</code> file defines all FASTQ files and sample comparisons of the analysis workflow.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">targetspath</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata"</span>, <span class="st">"targets.txt"</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">"systemPipeR"</span>)
<span class="no">targets</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.delim</a></span>(<span class="no">targetspath</span>, <span class="kw">comment.char</span> <span class="kw">=</span> <span class="st">"#"</span>)
<span class="no">targets</span>[<span class="fl">1</span>:<span class="fl">4</span>, <span class="fl">1</span>:<span class="fl">4</span>]</pre></body></html></div>
<pre><code>##                      FileName SampleName Factor SampleLong
## 1 ./data/SRR446027_1.fastq.gz        M1A     M1  Mock.1h.A
## 2 ./data/SRR446028_1.fastq.gz        M1B     M1  Mock.1h.B
## 3 ./data/SRR446029_1.fastq.gz        A1A     A1   Avr.1h.A
## 4 ./data/SRR446030_1.fastq.gz        A1B     A1   Avr.1h.B</code></pre>
</div>
</div>
<div id="read-preprocessing" class="section level1">
<h1 class="hasAnchor">
<a href="#read-preprocessing" class="anchor"></a>Read preprocessing</h1>
<div id="read-quality-filtering-and-trimming" class="section level2">
<h2 class="hasAnchor">
<a href="#read-quality-filtering-and-trimming" class="anchor"></a>Read quality filtering and trimming</h2>
<p>The function <code>preprocessReads</code> allows to apply predefined or custom read preprocessing functions to all FASTQ files referenced in a <code>SYSargs2</code> container, such as quality filtering or adapter trimming routines. The paths to the resulting output FASTQ files are stored in the <code>output</code> slot of the <code>SYSargs2</code> object. The following example performs adapter trimming with the <code>trimLRPatterns</code> function from the <code>Biostrings</code> package. After the trimming step a new targets file is generated (here <code>targets_trim.txt</code>) containing the paths to the trimmed FASTQ files. The new targets file can be used for the next workflow step with an updated <code>SYSargs2</code> instance, <em>e.g.</em> running the NGS alignments using the trimmed FASTQ files.</p>
<p>Construct <em><code>SYSargs2</code></em> object from <em><code>cwl</code></em> and <em><code>yml</code></em> param and <em><code>targets</code></em> files.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">dir_path</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata/cwl/preprocessReads/trim-se"</span>,
    <span class="kw">package</span> <span class="kw">=</span> <span class="st">"systemPipeR"</span>)
<span class="no">trim</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/systemPipeR/man/loadWorkflow.html">loadWorkflow</a></span>(<span class="kw">targets</span> <span class="kw">=</span> <span class="no">targetspath</span>, <span class="kw">wf_file</span> <span class="kw">=</span> <span class="st">"trim-se.cwl"</span>,
    <span class="kw">input_file</span> <span class="kw">=</span> <span class="st">"trim-se.yml"</span>, <span class="kw">dir_path</span> <span class="kw">=</span> <span class="no">dir_path</span>)
<span class="no">trim</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/systemPipeR/man/renderWF.html">renderWF</a></span>(<span class="no">trim</span>, <span class="kw">inputvars</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">FileName</span> <span class="kw">=</span> <span class="st">"_FASTQ_PATH1_"</span>,
    <span class="kw">SampleName</span> <span class="kw">=</span> <span class="st">"_SampleName_"</span>))
<span class="no">trim</span>
<span class="fu"><a href="https://rdrr.io/pkg/systemPipeR/man/sysargs2-methods.html">output</a></span>(<span class="no">trim</span>)[<span class="fl">1</span>:<span class="fl">2</span>]</pre></body></html></div>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/systemPipeR/man/preprocessReads.html">preprocessReads</a></span>(<span class="kw">args</span> <span class="kw">=</span> <span class="no">trim</span>, <span class="kw">Fct</span> <span class="kw">=</span> <span class="st">"trimLRPatterns(Rpattern='GCCCGGGTAA', 
                subject=fq)"</span>,
    <span class="kw">batchsize</span> <span class="kw">=</span> <span class="fl">1e+05</span>, <span class="kw">overwrite</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">compress</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="fu"><a href="https://rdrr.io/pkg/systemPipeR/man/writeTargetsout.html">writeTargetsout</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">trim</span>, <span class="kw">file</span> <span class="kw">=</span> <span class="st">"targets_trim.txt"</span>, <span class="kw">step</span> <span class="kw">=</span> <span class="fl">1</span>,
    <span class="kw">new_col</span> <span class="kw">=</span> <span class="st">"FileName1"</span>, <span class="kw">new_col_output_index</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">overwrite</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
</div>
<div id="fastq-quality-report" class="section level2">
<h2 class="hasAnchor">
<a href="#fastq-quality-report" class="anchor"></a>FASTQ quality report</h2>
<p>The following <code>seeFastq</code> and <code>seeFastqPlot</code> functions generate and plot a series of useful quality statistics for a set of FASTQ files including per cycle quality box plots, base proportions, base-level quality trends, relative k-mer diversity, length and occurrence distribution of reads, number of reads above quality cutoffs and mean quality distribution. The results are written to a PDF file named <code>fastqReport.pdf</code>.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">fqlist</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/systemPipeR/man/seeFastq.html">seeFastq</a></span>(<span class="kw">fastq</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/systemPipeR/man/sysargs.html">infile1</a></span>(<span class="no">trim</span>), <span class="kw">batchsize</span> <span class="kw">=</span> <span class="fl">10000</span>,
    <span class="kw">klength</span> <span class="kw">=</span> <span class="fl">8</span>)
<span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.html">pdf</a></span>(<span class="st">"./results/fastqReport.pdf"</span>, <span class="kw">height</span> <span class="kw">=</span> <span class="fl">18</span>, <span class="kw">width</span> <span class="kw">=</span> <span class="fl">4</span> * <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">fqlist</span>))
<span class="fu"><a href="https://rdrr.io/pkg/systemPipeR/man/seeFastq.html">seeFastqPlot</a></span>(<span class="no">fqlist</span>)
<span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span>()</pre></body></html></div>
<p><img src="results/fastqReport.png"></p>
<div align="center">
Figure 1: FASTQ quality report for 6 samples before filtering.
</div>
<p></p>
</div>
</div>
<div id="alignments" class="section level1">
<h1 class="hasAnchor">
<a href="#alignments" class="anchor"></a>Alignments</h1>
<div id="read-mapping-with-bowtiebismark" class="section level2">
<h2 class="hasAnchor">
<a href="#read-mapping-with-bowtiebismark" class="anchor"></a>Read mapping with <code>Bowtie/Bismark</code>
</h2>
<p>The NGS reads of this project will be aligned against the reference genome sequence using <code>Bowtie/Bismark</code> <span class="citation">(Langmead and Salzberg 2012, @Krueger2011–uu)</span> in both interactive job submissions and batch submissions to queuing systems of clusters using the <em><code>systemPipeR's</code></em> new CWL command-line interface.</p>
<!-- 
Get better explanation
-->
<p>Bisulfite sequencing aligners, like Bismark <span class="citation">Krueger and Andrews (2011)</span>] are based on three-letter algorithm. Which converts all Cs in the reference genome and the read into Ts, and thus, standard aligners with lower mappability can be adopted due to reduced sequence complexity.</p>
<p>Build <em><code>Bismark</code></em> index.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">dir_path</span> <span class="kw">&lt;-</span> <span class="st">"param/cwl/bismark/bismark_idx/"</span>
<span class="no">idx</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/systemPipeR/man/loadWorkflow.html">loadWorkflow</a></span>(<span class="kw">targets</span> <span class="kw">=</span> <span class="kw">NULL</span>, <span class="kw">wf_file</span> <span class="kw">=</span> <span class="st">"bismark-index.cwl"</span>,
    <span class="kw">input_file</span> <span class="kw">=</span> <span class="st">"bismark-index.yml"</span>, <span class="kw">dir_path</span> <span class="kw">=</span> <span class="no">dir_path</span>)
<span class="no">idx</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/systemPipeR/man/renderWF.html">renderWF</a></span>(<span class="no">idx</span>)
<span class="no">idx</span>
<span class="fu"><a href="https://rdrr.io/pkg/systemPipeR/man/sysargs2-methods.html">cmdlist</a></span>(<span class="no">idx</span>)

<span class="co">## Run in single machine</span>
<span class="fu"><a href="https://rdrr.io/pkg/systemPipeR/man/runCommandline.html">runCommandline</a></span>(<span class="no">idx</span>, <span class="kw">make_bam</span> <span class="kw">=</span> <span class="fl">FALSE</span>)</pre></body></html></div>
<p>The parameter settings of the aligner are defined in the <code>bismark-mapping.cwl</code> and <code>bismark-mapping.yml</code> files. The following shows how to construct the corresponding <em>SYSargs2</em> object, here <em>args</em>.</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">dir_path</span> <span class="kw">&lt;-</span> <span class="st">"param/cwl/bismark/bismark/"</span>
<span class="no">args</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/systemPipeR/man/loadWorkflow.html">loadWorkflow</a></span>(<span class="kw">targets</span> <span class="kw">=</span> <span class="no">targetspath</span>, <span class="kw">wf_file</span> <span class="kw">=</span> <span class="st">"bismark-mapping-se.cwl"</span>,
    <span class="kw">input_file</span> <span class="kw">=</span> <span class="st">"bismark-mapping-se.yml"</span>, <span class="kw">dir_path</span> <span class="kw">=</span> <span class="no">dir_path</span>)
<span class="no">args</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/systemPipeR/man/renderWF.html">renderWF</a></span>(<span class="no">args</span>, <span class="kw">inputvars</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">FileName</span> <span class="kw">=</span> <span class="st">"_FASTQ_PATH1_"</span>,
    <span class="kw">SampleName</span> <span class="kw">=</span> <span class="st">"_SampleName_"</span>))
<span class="no">args</span>
<span class="fu"><a href="https://rdrr.io/pkg/systemPipeR/man/sysargs2-methods.html">cmdlist</a></span>(<span class="no">args</span>)[<span class="fl">1</span>:<span class="fl">2</span>]
<span class="fu"><a href="https://rdrr.io/pkg/systemPipeR/man/sysargs2-methods.html">output</a></span>(<span class="no">args</span>)[<span class="fl">1</span>:<span class="fl">2</span>]
<span class="co">## Run in single machine</span>
<span class="no">args</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/systemPipeR/man/runCommandline.html">runCommandline</a></span>(<span class="no">args</span>, <span class="kw">make_bam</span> <span class="kw">=</span> <span class="fl">FALSE</span>)</pre></body></html></div>
<p>Check whether all BAM files have been created and write the new <code>targets file</code>.</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">outpaths</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/systemPipeR/man/subsetWF.html">subsetWF</a></span>(<span class="no">args</span>, <span class="kw">slot</span> <span class="kw">=</span> <span class="st">"output"</span>, <span class="kw">subset</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">index</span> <span class="kw">=</span> <span class="fl">1</span>)
<span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span>(<span class="no">outpaths</span>)
<span class="fu"><a href="https://rdrr.io/r/base/source.html">source</a></span>(<span class="st">"R_function/writeTargetsout2.R"</span>)
<span class="fu">writeTargetsout2</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">args</span>, <span class="kw">file</span> <span class="kw">=</span> <span class="st">"targets_bismark.txt"</span>, <span class="kw">overwrite</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
    <span class="kw">folder</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
</div>
<div id="read-and-plot-the-alignment-stats" class="section level2">
<h2 class="hasAnchor">
<a href="#read-and-plot-the-alignment-stats" class="anchor"></a>Read and plot the alignment stats</h2>
<p>The following step provides an overview of the number of reads in each sample and how many of them aligned to the reference. By default, in the alignment process, after the conversion to bedGraph has completed, the option –cytosine_report produces a genome-wide methylation report for all cytosines in the genome. The following step generates a graphics output with methylation levels.</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/source.html">source</a></span>(<span class="st">"R_function/read.align.bs.R"</span>)  <span class="co">## FIX rownames TABLE.</span>
<span class="no">align_stats</span> <span class="kw">&lt;-</span> <span class="fu">read.align.bs</span>()
<span class="no">align_stats</span>[<span class="fl">1</span>:<span class="fl">4</span>, <span class="fl">1</span>:<span class="fl">2</span>]</pre></body></html></div>
<img src="results/align.bs_plot.png"><div align="center">
Figure 3: Alignment status.
</div>
<p></p>
<img src="results/methyl.levels_plot.png"><div align="center">
Figure 4: Methylation Levels across the samples.
</div>
<p></p>
</div>
<div id="methylation-calling" class="section level2">
<h2 class="hasAnchor">
<a href="#methylation-calling" class="anchor"></a>Methylation Calling</h2>
<p>In order to extract the methylation call for every single C analysed from the Bismark alignment files, we used the <code>bismark_methylation_extractor</code> function. The parameter settings of the function are defined in the <code>bismark_methyl_extractor.param</code> file. Submission of Bismark_extract as a single process.</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="no">args</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/systemPipeR/man/systemArgs.html">systemArgs</a></span>(<span class="kw">sysma</span> <span class="kw">=</span> <span class="st">"param/bismark_methyl_extractor.param"</span>,
    <span class="kw">mytargets</span> <span class="kw">=</span> <span class="st">"targets_bismark.txt"</span>)
<span class="fu"><a href="https://rdrr.io/pkg/systemPipeR/man/sysargs.html">sysargs</a></span>(<span class="no">args</span>)[<span class="fl">1</span>]  <span class="co"># Command-line parameters for first FASTQ file </span>
<span class="fu"><a href="https://rdrr.io/r/base/source.html">source</a></span>(<span class="st">"runCommandline.bs.R"</span>)
<span class="kw">for</span> (<span class="no">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="kw">along</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/systemPipeR/man/sysargs.html">outpaths</a></span>(<span class="no">args</span>))) {
    <span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/systemPipeR/man/sysargs.html">outpaths</a></span>(<span class="no">args</span>)[<span class="no">i</span>], <span class="kw">showWarnings</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
}
<span class="fu"><a href="https://rdrr.io/pkg/systemPipeR/man/moduleload.html">moduleload</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/systemPipeR/man/sysargs.html">modules</a></span>(<span class="no">args</span>))
<span class="fu">runCommandline_bs</span>(<span class="no">args</span>)</pre></body></html></div>
<p><img src="results/SRR5494752.fastq_trim.gz_bismark_bt2.M-bias_R1.png"></p>
<div align="center">
Figure 5: Methylation proportion acrros each possible position in the read, in the first sample.
</div>
<p></p>
<p>Alternatively, submit jobs to compute cluster.</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="no">resources</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">walltime</span> <span class="kw">=</span> <span class="fl">1440</span>, <span class="kw">ntasks</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">ncpus</span> <span class="kw">=</span> <span class="fl">14</span>, <span class="kw">memory</span> <span class="kw">=</span> <span class="fl">10240</span>,
    <span class="kw">email</span> <span class="kw">=</span> <span class="st">"danielac@ucr.edu"</span>)
<span class="no">reg</span> <span class="kw">&lt;-</span> <span class="fu">clusterRun2</span>(<span class="no">args</span>, <span class="kw">FUN</span> <span class="kw">=</span> <span class="no">runCommandline_bs</span>, <span class="kw">conf.file</span> <span class="kw">=</span> <span class="st">".batchtools.conf.R"</span>,
    <span class="kw">template</span> <span class="kw">=</span> <span class="st">"batchtools.slurm.tmpl"</span>, <span class="kw">runid</span> <span class="kw">=</span> <span class="st">"01"</span>, <span class="kw">resourceList</span> <span class="kw">=</span> <span class="no">resources</span>)</pre></body></html></div>
</div>
</div>
<div id="descriptive-statistics-on-dna-methylation-profiles" class="section level1">
<h1 class="hasAnchor">
<a href="#descriptive-statistics-on-dna-methylation-profiles" class="anchor"></a>Descriptive statistics on DNA methylation profiles</h1>
<p>The coverage per base and Percentage of methylation per base are calculeted using the <code>methylKit</code> R package [Akalin2012-ez].</p>
<div id="import-of-bismark-methylation-output-files" class="section level2">
<h2 class="hasAnchor">
<a href="#import-of-bismark-methylation-output-files" class="anchor"></a>Import of Bismark methylation output files</h2>
<p>The <code>Bisrmark</code> results can be loaded with <code>methRead</code> function. Note that a list containing the paths of the cytosine report files from Bismark needs to be provided, which contains chromosome, position, strand, count methylated, count unmethylated, C-context and trinucleotide context format (output file <code>*.cov</code>. In this case, use <code>pipeline='bismarkCoverage</code>.</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">methylKit</span>)
<span class="fu"><a href="https://rdrr.io/r/base/source.html">source</a></span>(<span class="st">"R_function/run_methylKit.R"</span>)
<span class="no">targetspath</span> <span class="kw">&lt;-</span> <span class="st">"targets.txt"</span>
<span class="no">targets</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.delim</a></span>(<span class="no">targetspath</span>, <span class="kw">comment</span> <span class="kw">=</span> <span class="st">"#"</span>)
<span class="no">cmp</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/systemPipeR/man/readComp.html">readComp</a></span>(<span class="kw">file</span> <span class="kw">=</span> <span class="no">targetspath</span>, <span class="kw">format</span> <span class="kw">=</span> <span class="st">"matrix"</span>, <span class="kw">delim</span> <span class="kw">=</span> <span class="st">"-"</span>)
<span class="no">args</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/systemPipeR/man/systemArgs.html">systemArgs</a></span>(<span class="kw">sysma</span> <span class="kw">=</span> <span class="st">"param/bismark_methyl_extractor.param"</span>,
    <span class="kw">mytargets</span> <span class="kw">=</span> <span class="st">"targets_bismark.txt"</span>)
<span class="no">import.bs</span> <span class="kw">&lt;-</span> <span class="fu">import.bs.data</span>(<span class="no">targets</span>, <span class="no">args</span>, <span class="kw">cmp</span> <span class="kw">=</span> <span class="no">cmp</span><span class="kw">[[</span><span class="fl">1</span>]])</pre></body></html></div>
<p>Alternatively, methylation results can be calculated from sorted SAM or BAM files from Bismark aligner. The coordinate sorted so an extra re-sort step is required, and <code>Samtools</code>[Li2011-qu] are used. The parameter settings of <code>Samtools</code> are defined in the <code>samtools.param</code> file.</p>
<p>The following provides the code on a single machine, but the processing can be submitted to a compute cluster, as well.</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="co">## Please note this step may take a while ...</span>
<span class="fu"><a href="https://rdrr.io/r/base/source.html">source</a></span>(<span class="st">"clusterRun2.R"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/source.html">source</a></span>(<span class="st">"runCommandline2.R"</span>)
<span class="no">args</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/systemPipeR/man/systemArgs.html">systemArgs</a></span>(<span class="kw">sysma</span> <span class="kw">=</span> <span class="st">"param/samtools.param"</span>, <span class="kw">mytargets</span> <span class="kw">=</span> <span class="st">"targets_bismark.txt"</span>)
<span class="fu"><a href="https://rdrr.io/pkg/systemPipeR/man/sysargs.html">sysargs</a></span>(<span class="no">args</span>)[<span class="fl">1</span>]  <span class="co"># Command-line parameters for first FASTQ file </span>
<span class="fu"><a href="https://rdrr.io/pkg/systemPipeR/man/runCommandline.html">runCommandline</a></span>(<span class="no">args</span>, <span class="kw">make_bam</span> <span class="kw">=</span> <span class="fl">FALSE</span>)

<span class="no">report1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/systemPipeR/man/sysargs.html">outfile1</a></span>(<span class="no">args</span>))
<span class="no">sample.id</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="no">targets</span>$<span class="no">SampleName</span>)
<span class="no">methRaw</span> <span class="kw">&lt;-</span> <span class="fu">processBismarkAln</span>(<span class="kw">location</span> <span class="kw">=</span> <span class="no">report1</span>, <span class="kw">sample.id</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span>(<span class="no">sample.id</span>),
    <span class="kw">assembly</span> <span class="kw">=</span> <span class="st">"TAIR10"</span>, <span class="kw">save.folder</span> <span class="kw">=</span> <span class="st">"results/"</span>, <span class="kw">save.context</span> <span class="kw">=</span> <span class="kw">NULL</span>,
    <span class="kw">read.context</span> <span class="kw">=</span> <span class="st">"CpG"</span>, <span class="kw">nolap</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">mincov</span> <span class="kw">=</span> <span class="fl">10</span>, <span class="kw">minqual</span> <span class="kw">=</span> <span class="fl">20</span>,
    <span class="kw">phred64</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">treatment</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>))</pre></body></html></div>
</div>
<div id="coverage-per-base-and-percentage-of-methylation-per-base" class="section level2">
<h2 class="hasAnchor">
<a href="#coverage-per-base-and-percentage-of-methylation-per-base" class="anchor"></a>Coverage per base and Percentage of methylation per base</h2>
<p>Histogram of percentage of methylation per cytosine for the first sample generated with the <code>methylKit</code>. Typically, the results of methylation will have a bimodal distribution, which represents the majority of bases with high or low methylation.</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.html">pdf</a></span>(<span class="st">"./results/hist_percent_CpG_methyl_sample1.pdf"</span>)
<span class="fu">getMethylationStats</span>(<span class="no">import.bs</span><span class="kw">[[</span><span class="fl">1</span>]]<span class="kw">[[</span><span class="fl">1</span>]], <span class="kw">plot</span> <span class="kw">=</span> <span class="no">T</span>, <span class="kw">both.strands</span> <span class="kw">=</span> <span class="no">F</span>)
<span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span>()</pre></body></html></div>
<img src="results/hist_percent_CpG_methyl_sample1.png"><div align="center">
Figure 5: Percentage of methylation per base for the first sample.
</div>
<p></p>
<p>The read coverage distribution can be used as an important indication of PCR duplications bias. It is possible to observe secondary peak on the right side of the distribution if the PCR duplication bias is present.</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.html">pdf</a></span>(<span class="st">"./results/hist_CpG_coverage_sample1.pdf"</span>)
<span class="fu">getCoverageStats</span>(<span class="no">import.bs</span><span class="kw">[[</span><span class="fl">1</span>]]<span class="kw">[[</span><span class="fl">1</span>]], <span class="kw">plot</span> <span class="kw">=</span> <span class="no">T</span>, <span class="kw">both.strands</span> <span class="kw">=</span> <span class="no">F</span>)
<span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span>()</pre></body></html></div>
<img src="results/hist_CpG_coverage_sample1.png"><div align="center">
Figure 6: Coverage base for the first sample.
</div>
<p></p>
</div>
</div>
<div id="correlation-analysis-between-samples" class="section level1">
<h1 class="hasAnchor">
<a href="#correlation-analysis-between-samples" class="anchor"></a>Correlation analysis between samples</h1>
<p>The following computes the sample-wise <code>Spearman</code> correlation coefficients between the percentage of methylation profiles across all samples, generated with the <code>methylKit</code> package. In order to calculated the following analysis, it is necessary merge all samples, which only cytosines covered in all samples are stored.</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="no">merged_samples</span> <span class="kw">&lt;-</span> <span class="fu">unite</span>(<span class="no">import.bs</span><span class="kw">[[</span><span class="fl">1</span>]]<span class="kw">[[</span><span class="fl">1</span>]], <span class="kw">destrand</span> <span class="kw">=</span> <span class="fl">FALSE</span>)</pre></body></html></div>
<p>Generte table of percentage methylation for all samples.</p>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="no">perc.meth</span> <span class="kw">&lt;-</span> <span class="fu">percMethylation</span>(<span class="no">merged_samples</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.table</a></span>(<span class="no">perc.meth</span>, <span class="st">"./results/percent_methylation.xls"</span>, <span class="kw">row.names</span> <span class="kw">=</span> <span class="fl">FALSE</span>,
    <span class="kw">quote</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">sep</span> <span class="kw">=</span> <span class="st">"\t"</span>)</pre></body></html></div>
<p>The correlation between samples is calculated using <code>getCorrelation</code> function. The analysis can detecting sample outliers.</p>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.html">pdf</a></span>(<span class="st">"./results/sample_correlation.pdf"</span>)
<span class="fu">getCorrelation</span>(<span class="no">merged_samples</span>, <span class="kw">plot</span> <span class="kw">=</span> <span class="no">T</span>, <span class="kw">method</span> <span class="kw">=</span> <span class="st">"spearman"</span>)
<span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span>()
<span class="no">get_corr</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/capture.output.html">capture.output</a></span>(<span class="fu">getCorrelation</span>(<span class="no">merged_samples</span>, <span class="kw">plot</span> <span class="kw">=</span> <span class="no">F</span>))
<span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.table</a></span>(<span class="no">get_corr</span>, <span class="st">"./results/sample_correlation.xls"</span>, <span class="kw">row.names</span> <span class="kw">=</span> <span class="fl">FALSE</span>,
    <span class="kw">quote</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">sep</span> <span class="kw">=</span> <span class="st">"\t"</span>)</pre></body></html></div>
<img src="results/sample_correlation.png"><div align="center">
<strong>Figure 7:</strong> Sample correlation
</div>
<p></p>
<p>Also, it is possible to cluster samples hierarchically based on methylation profiles using <code>Euclidean</code> correlation distance.</p>
<div class="sourceCode" id="cb21"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.html">pdf</a></span>(<span class="st">"./results/sample_clustering.pdf"</span>)
<span class="fu">clusterSamples</span>(<span class="no">merged_samples</span>, <span class="kw">dist</span> <span class="kw">=</span> <span class="st">"euclidean"</span>, <span class="kw">method</span> <span class="kw">=</span> <span class="st">"ward"</span>,
    <span class="kw">plot</span> <span class="kw">=</span> <span class="no">T</span>)
<span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span>()</pre></body></html></div>
<img src="results/sample_clustering.png"><div align="center">
<strong>Figure 8:</strong> Correlation dendogram os samples.
</div>
<p></p>
<p>Principal Component Analysis (PCA) of the methylation profiles, plot shows principal component 1 and principal component 2 for each sample. Samples closer to each other in principal component space are similar in their methylation profiles.</p>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.html">pdf</a></span>(<span class="st">"./results/sample_PCA.pdf"</span>)
<span class="fu">PCASamples</span>(<span class="no">merged_samples</span>)
<span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span>()</pre></body></html></div>
<img src="results/sample_PCA.png"><div align="center">
<strong>Figure 9:</strong> Sample PCA
</div>
<p></p>
</div>
<div id="analysis-of-differentially-methylated-regions-dmrs" class="section level1">
<h1 class="hasAnchor">
<a href="#analysis-of-differentially-methylated-regions-dmrs" class="anchor"></a>Analysis of differentially methylated regions (DMRs)</h1>
<div id="dmr-analysis-with-methylkit" class="section level2">
<h2 class="hasAnchor">
<a href="#dmr-analysis-with-methylkit" class="anchor"></a>DMR analysis with <code>MethylKit</code>
</h2>
<p>The analysis of differentially DNA methylation is calculatedby comparing methylation levels between multiple conditions, in order to show the important differences between a treatment and a control group. The following step used the <code>calculateDiffMeth</code> function from <code>MethylKit</code> package to calculate differential methylation. The samples comparisons used by this analysis are defined in the header lines of the <code>targets.txt</code> file. The calculation was based on logistic regression to calculate P-values. P-values will be adjusted to Q-values using SLIM method.</p>
<p>It is possible to select the differentially methylated regions/bases based on q-value and percent methylation difference cutoffs. The following example selects the bases that have <code>q-value &lt; 0.01</code> and percent methylation difference larger than 25%.</p>
<div class="sourceCode" id="cb23"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">methylKit</span>)
<span class="fu"><a href="https://rdrr.io/r/base/source.html">source</a></span>(<span class="st">"R_function/run_methylKit.R"</span>)
<span class="no">targetspath</span> <span class="kw">&lt;-</span> <span class="st">"targets.txt"</span>
<span class="no">targets</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.delim</a></span>(<span class="no">targetspath</span>, <span class="kw">comment</span> <span class="kw">=</span> <span class="st">"#"</span>)
<span class="no">cmp</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/systemPipeR/man/readComp.html">readComp</a></span>(<span class="kw">file</span> <span class="kw">=</span> <span class="no">targetspath</span>, <span class="kw">format</span> <span class="kw">=</span> <span class="st">"matrix"</span>, <span class="kw">delim</span> <span class="kw">=</span> <span class="st">"-"</span>)
<span class="no">args</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/systemPipeR/man/systemArgs.html">systemArgs</a></span>(<span class="kw">sysma</span> <span class="kw">=</span> <span class="st">"param/bismark_methyl_extractor.param"</span>,
    <span class="kw">mytargets</span> <span class="kw">=</span> <span class="st">"targets_bismark.txt"</span>)
<span class="no">dmr.DF</span> <span class="kw">&lt;-</span> <span class="fu">run_methylKit</span>(<span class="no">targets</span>, <span class="no">args</span>, <span class="kw">cmp</span> <span class="kw">=</span> <span class="no">cmp</span><span class="kw">[[</span><span class="fl">1</span>]], <span class="kw">assembly</span> <span class="kw">=</span> <span class="st">"TAIR10"</span>,
    <span class="kw">filter</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">qvalue</span> <span class="kw">=</span> <span class="fl">0.01</span>, <span class="kw">difference</span> <span class="kw">=</span> <span class="fl">25</span>), <span class="kw">plot</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<img src="results/DMR_methyl.png"><div align="center">
<strong>Figure 10:</strong> Differentially methylated regions (DMRs)
</div>
<p></p>
</div>
<div id="dmr-analysis-with-dss" class="section level2">
<h2 class="hasAnchor">
<a href="#dmr-analysis-with-dss" class="anchor"></a>DMR analysis with <code>DSS</code>
</h2>
<p>Perform statistical test for DML by calling DMLtest function. This function basically performs following steps: (1) estimate mean methylation levels for all CpG site; (2) estimate dispersions at each CpG sites; (3) conduct Wald test. For the first step, there’s an option for smoothing or not. Because the methylation levels show strong spatial correlations, smoothing can help obtain better estimates of mean methylation when the CpG sites are dense in the data (such as from the whole-genome BS-seq). However for data with sparse CpG, such as from RRBS or hydroxyl-methylation, smoothing is not recommended.</p>
<p>User has the option to smooth the methylation levels or not. For WGBS data, smoothing is recommended so that information from nearby CpG sites can be combined to improve the estimation of methylation levels. A simple moving average algorithm is implemented for smoothing. In RRBS since the CpG coverage is sparse, smoothing might not alter the results much. If smoothing is requested, smoothing span is an important parameter which has non-trivial impact on DMR calling. We use 500 bp as default, and think that it performs well in real data tests.</p>
<p>With the test results, one can call DML by using callDML function. The results DMLs are sorted by the significance.</p>
<p>DMR detection is also Based on the DML test results, by calling callDMR function. Regions with many statistically significant CpG sites are identified as DMRs. Some restrictions are provided by users, including the minimum length, minimum number of CpG sites, percentage of CpG site being significant in the region, etc. There are some post hoc procedures to merge nearby DMRs into longer ones.</p>
<p>Note that the distribution of test statistics (and p-values) depends on the differences in methylation levels and biological variations, as well as technical factors such as coverage depth. It is very difficulty to select a natural and rigorous threshold for defining DMRs. We recommend users try different thresholds in order to obtain satisfactory results. 5. The DMRs can be visualized using showOneDMR function, This function provides more information than the plotRegion function in bsseq. It plots the methylation percentages as well as the coverage depths at each CpG sites, instead of just the smoothed curve. So the coverage depth information will be available in the figure. To use the function, do</p>
<div class="sourceCode" id="cb24"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">DSS</span>)
<span class="fu"><a href="https://rdrr.io/r/base/source.html">source</a></span>(<span class="st">"R_function/run_dds.R"</span>)
<span class="no">targetspath</span> <span class="kw">&lt;-</span> <span class="st">"targets.txt"</span>
<span class="no">targets</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.delim</a></span>(<span class="no">targetspath</span>, <span class="kw">comment</span> <span class="kw">=</span> <span class="st">"#"</span>)
<span class="no">cmp</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/systemPipeR/man/readComp.html">readComp</a></span>(<span class="kw">file</span> <span class="kw">=</span> <span class="no">targetspath</span>, <span class="kw">format</span> <span class="kw">=</span> <span class="st">"matrix"</span>, <span class="kw">delim</span> <span class="kw">=</span> <span class="st">"-"</span>)
<span class="no">args</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/systemPipeR/man/systemArgs.html">systemArgs</a></span>(<span class="kw">sysma</span> <span class="kw">=</span> <span class="st">"param/bismark_methyl_extractor.param"</span>,
    <span class="kw">mytargets</span> <span class="kw">=</span> <span class="st">"targets_bismark.txt"</span>)
<span class="no">dss.DF</span> <span class="kw">&lt;-</span> <span class="fu">run_dss</span>(<span class="no">targets</span>, <span class="no">args</span>, <span class="kw">cmp</span> <span class="kw">=</span> <span class="no">cmp</span><span class="kw">[[</span><span class="fl">1</span>]], <span class="kw">smoothing</span> <span class="kw">=</span> <span class="fl">TRUE</span>)

<span class="co">## Calling DML</span>
<span class="no">dmls</span> <span class="kw">&lt;-</span> <span class="fu">callDML</span>(<span class="no">dss.DF</span><span class="kw">[[</span><span class="fl">1</span>]], <span class="kw">delta</span> <span class="kw">=</span> <span class="fl">0.1</span>, <span class="kw">p.threshold</span> <span class="kw">=</span> <span class="fl">0.001</span>)

<span class="co">## Calling DMR</span>
<span class="no">dss.obj</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span>(<span class="st">"./results/dss.input_C-S.rds"</span>)
<span class="no">dmrs</span> <span class="kw">&lt;-</span> <span class="fu">callDMR</span>(<span class="no">dss.DF</span><span class="kw">[[</span><span class="fl">1</span>]], <span class="kw">delta</span> <span class="kw">=</span> <span class="fl">0.1</span>, <span class="kw">p.threshold</span> <span class="kw">=</span> <span class="fl">0.05</span>)
<span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.html">pdf</a></span>(<span class="st">"./results/plotRegion.DMR.pdf"</span>)
<span class="fu">showOneDMR</span>(<span class="no">dmrs</span>[<span class="fl">1</span>, ], <span class="no">dss.obj</span>)
<span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span>()</pre></body></html></div>
<p><img src="results/sample_PCA.png"></p>
<div align="center">
<strong>Figure 10:</strong> Methylation percentages and the coverage depths at each CpG sites.
</div>
<p></p>
</div>
<div id="dmr-analysis-with-biseq" class="section level2">
<h2 class="hasAnchor">
<a href="#dmr-analysis-with-biseq" class="anchor"></a>DMR analysis with <code>Biseq</code>
</h2>
<div id="import-of-bismarks-methylation-output-files-with-biseq-package-biseq-" class="section level3">
<h3 class="hasAnchor">
<a href="#import-of-bismarks-methylation-output-files-with-biseq-package-biseq-" class="anchor"></a>Import of Bismark’s methylation output files with <code>BiSeq</code> package <span class="citation">(Hebestreit and Klein 2015)</span>.</h3>
<div class="sourceCode" id="cb25"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">BiSeq</span>)
<span class="no">path</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(), <span class="st">"/results"</span>, <span class="kw">sep</span> <span class="kw">=</span> <span class="st">""</span>)
<span class="no">report</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>()
<span class="no">file.list</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span>(<span class="no">path</span>, <span class="st">"*.extractor"</span>, <span class="kw">full.names</span> <span class="kw">=</span> <span class="fl">TRUE</span>))
<span class="no">report</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>()
<span class="kw">for</span> (<span class="no">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="kw">along</span> <span class="kw">=</span> <span class="no">file.list</span>)) {
    <span class="no">file.list1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="no">file.list</span>[<span class="no">i</span>]), <span class="st">".cov"</span>,
        <span class="kw">full.names</span> <span class="kw">=</span> <span class="fl">TRUE</span>))
    <span class="no">report</span>[<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">report</span>) + <span class="fl">1</span>] <span class="kw">&lt;-</span> <span class="no">file.list1</span>
}
<span class="no">colData</span> <span class="kw">&lt;-</span> <span class="fu">DataFrame</span>(<span class="kw">group</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Control"</span>, <span class="st">"Control"</span>, <span class="st">"Control"</span>,
    <span class="st">"Stress"</span>, <span class="st">"Stress"</span>, <span class="st">"Stress"</span>)), <span class="kw">row.names</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"C1"</span>, <span class="st">"C2"</span>,
    <span class="st">"C3"</span>, <span class="st">"S1"</span>, <span class="st">"S2"</span>, <span class="st">"S3"</span>))
<span class="no">wgbs</span> <span class="kw">&lt;-</span> <span class="fu">readBismark</span>(<span class="kw">files</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="no">report</span>), <span class="no">colData</span>)</pre></body></html></div>
<p>Number of CpG sites that were covered per sample together with the median of the coverage of these CpG sites and the representation of the coverage distributions per sample.</p>
<div class="sourceCode" id="cb26"><html><body><pre class="r"><span class="fu">covStatistics</span>(<span class="no">wgbs</span>)
<span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.html">pdf</a></span>(<span class="st">"./results/CoverangePerSample_biseq.pdf"</span>)
<span class="fu">covBoxplots</span>(<span class="no">wgbs</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="st">"cornflowerblue"</span>, <span class="kw">las</span> <span class="kw">=</span> <span class="fl">2</span>)
<span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span>()</pre></body></html></div>
<p>The following detect differentially methylation regions within two groups os samples. First, we detect CpG clusters</p>
<div class="sourceCode" id="cb27"><html><body><pre class="r"><span class="no">wgbs.small</span> <span class="kw">&lt;-</span> <span class="no">wgbs</span>[<span class="fl">1</span>:<span class="fl">10000</span>, ]
<span class="no">wgbs.clust.unlim</span> <span class="kw">&lt;-</span> <span class="fu">clusterSites</span>(<span class="kw">object</span> <span class="kw">=</span> <span class="no">wgbs.small</span>, <span class="kw">perc.samples</span> <span class="kw">=</span> <span class="fl">4</span>/<span class="fl">6</span>,
    <span class="kw">min.sites</span> <span class="kw">=</span> <span class="fl">20</span>, <span class="kw">max.dist</span> <span class="kw">=</span> <span class="fl">100</span>, <span class="kw">minCov</span> <span class="kw">=</span> <span class="fl">6</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fu">rowRanges</span>(<span class="no">wgbs.clust.unlim</span>))
<span class="fu">clusterSitesToGR</span>(<span class="no">wgbs.clust.unlim</span>)</pre></body></html></div>
<p>Next, smooth methylation data within CpG clusters, in order to reduce bias due to high coverages. The effect of the smoothing step can be plot.</p>
<div class="sourceCode" id="cb28"><html><body><pre class="r"><span class="no">ind.cov</span> <span class="kw">&lt;-</span> <span class="fu">totalReads</span>(<span class="no">wgbs.clust.unlim</span>) <span class="kw">&gt;</span> <span class="fl">0</span>
<span class="no">quant</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span>(<span class="fu">totalReads</span>(<span class="no">wgbs.clust.unlim</span>)[<span class="no">ind.cov</span>], <span class="fl">0.9</span>)
<span class="no">quant</span>
<span class="no">wgbs.clust.lim</span> <span class="kw">&lt;-</span> <span class="fu">limitCov</span>(<span class="no">wgbs.clust.unlim</span>, <span class="kw">maxCov</span> <span class="kw">=</span> <span class="no">quant</span>)
<span class="fu">covBoxplots</span>(<span class="no">wgbs.clust.lim</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="st">"cornflowerblue"</span>, <span class="kw">las</span> <span class="kw">=</span> <span class="fl">2</span>)
<span class="no">predictedMeth</span> <span class="kw">&lt;-</span> <span class="fu">predictMeth</span>(<span class="kw">object</span> <span class="kw">=</span> <span class="no">wgbs.clust.lim</span>)
<span class="no">predictedMeth</span>
<span class="no">region</span> <span class="kw">&lt;-</span> <span class="fu">GRanges</span>(<span class="kw">seqnames</span> <span class="kw">=</span> <span class="st">"5"</span>, <span class="kw">ranges</span> <span class="kw">=</span> <span class="fu">IRanges</span>(<span class="kw">start</span> <span class="kw">=</span> <span class="fl">100</span>,
    <span class="kw">end</span> <span class="kw">=</span> <span class="fl">830</span>))
<span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.html">pdf</a></span>(<span class="st">"./results/smoothed_biseq.pdf"</span>)
<span class="fu">plotMeth</span>(<span class="kw">object.raw</span> <span class="kw">=</span> <span class="no">wgbs</span>[, <span class="fl">2</span>], <span class="kw">object.rel</span> <span class="kw">=</span> <span class="no">predictedMeth</span>[,
    <span class="fl">2</span>], <span class="kw">region</span> <span class="kw">=</span> <span class="no">region</span>, <span class="kw">lwd.lines</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">col.points</span> <span class="kw">=</span> <span class="st">"blue"</span>,
    <span class="kw">cex</span> <span class="kw">=</span> <span class="fl">1.5</span>)
<span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span>()</pre></body></html></div>
<img src="results/smoothed_biseq.png"><div align="center">
<strong>Figure 11:</strong> Smooth methylation levels.
</div>
<p></p>
<p>The follow show the differential methylation between the comparison for some CpG sites. Test CpG clusters for differential methylation and control weighted FDR on cluster.</p>
<div class="sourceCode" id="cb29"><html><body><pre class="r"><span class="no">control</span> <span class="kw">&lt;-</span> <span class="no">predictedMeth</span>[, <span class="fu">colData</span>(<span class="no">predictedMeth</span>)$<span class="no">group</span> <span class="kw">==</span> <span class="st">"Control"</span>]
<span class="no">stress</span> <span class="kw">&lt;-</span> <span class="no">predictedMeth</span>[, <span class="fu">colData</span>(<span class="no">predictedMeth</span>)$<span class="no">group</span> <span class="kw">==</span> <span class="st">"Stress"</span>]
<span class="no">mean.control</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span>(<span class="fu">methLevel</span>(<span class="no">control</span>))
<span class="no">mean.stress</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span>(<span class="fu">methLevel</span>(<span class="no">stress</span>))
<span class="no">betaResults</span> <span class="kw">&lt;-</span> <span class="fu">betaRegression</span>(<span class="kw">formula</span> <span class="kw">=</span> ~<span class="no">group</span>, <span class="kw">link</span> <span class="kw">=</span> <span class="st">"probit"</span>,
    <span class="kw">object</span> <span class="kw">=</span> <span class="no">predictedMeth</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"BR"</span>)

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">betaResults</span>)
<span class="no">vario</span> <span class="kw">&lt;-</span> <span class="fu">makeVariogram</span>(<span class="no">betaResults</span>)
<span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.html">pdf</a></span>(<span class="st">"./results/smoothed_levels_biseq.pdf"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">mean.stress</span>, <span class="no">mean.control</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="st">"blue"</span>, <span class="kw">xlab</span> <span class="kw">=</span> <span class="st">"Methylation in Controls"</span>,
    <span class="kw">ylab</span> <span class="kw">=</span> <span class="st">"Methylation in Stress"</span>)
<span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span>()</pre></body></html></div>
<img src="results/smoothed_levels_biseq.png"><div align="center">
<strong>Figure 12:</strong> Smooth methylation levels between control and stress samples..
</div>
<p></p>
<p>Detect CpG clusters containing at least one differentially methylated location.</p>
<div class="sourceCode" id="cb30"><html><body><pre class="r"><span class="no">predictedMethNull</span> <span class="kw">&lt;-</span> <span class="no">predictedMeth</span>[<span class="fl">1</span>:<span class="fl">800</span>, <span class="fl">1</span>:<span class="fl">6</span>]
<span class="fu">colData</span>(<span class="no">predictedMethNull</span>)$<span class="no">group.null</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">2</span>), <span class="fl">3</span>)
<span class="no">betaResultsNull</span> <span class="kw">&lt;-</span> <span class="fu">betaRegression</span>(<span class="kw">formula</span> <span class="kw">=</span> ~<span class="no">group.null</span>, <span class="kw">link</span> <span class="kw">=</span> <span class="st">"probit"</span>,
    <span class="kw">object</span> <span class="kw">=</span> <span class="no">predictedMethNull</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"BR"</span>)
<span class="no">vario</span> <span class="kw">&lt;-</span> <span class="fu">makeVariogram</span>(<span class="no">betaResultsNull</span>)
<span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.html">pdf</a></span>(<span class="st">"./results/estimated_variogram_biseq.pdf"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">vario</span>$<span class="no">variogram</span>$<span class="no">v</span>)
<span class="no">vario.sm</span> <span class="kw">&lt;-</span> <span class="fu">smoothVariogram</span>(<span class="no">vario</span>, <span class="kw">sill</span> <span class="kw">=</span> <span class="fl">0.9</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="no">vario.sm</span>$<span class="no">variogram</span>[, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"h"</span>, <span class="st">"v.sm"</span>)], <span class="kw">col</span> <span class="kw">=</span> <span class="st">"red"</span>, <span class="kw">lwd</span> <span class="kw">=</span> <span class="fl">1.5</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/grid.html">grid</a></span>()
<span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span>()</pre></body></html></div>
<p>Next, we trimed the rejected CpG clusters that is to remove the not differentially methylated CpG sites at q1 what can be interpreted as the location-wise FDR. Also, it is possible define the boundaries of DMRs as rejected CpG sites within which rejected CpG sites solely are located.</p>
<div class="sourceCode" id="cb31"><html><body><pre class="r"><span class="no">vario.aux</span> <span class="kw">&lt;-</span> <span class="fu">makeVariogram</span>(<span class="no">betaResults</span>, <span class="kw">make.variogram</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
<span class="no">vario.sm</span>$<span class="no">pValsList</span> <span class="kw">&lt;-</span> <span class="no">vario.aux</span>$<span class="no">pValsList</span>
<span class="no">locCor</span> <span class="kw">&lt;-</span> <span class="fu">estLocCor</span>(<span class="no">vario.sm</span>)
<span class="no">clusters.rej</span> <span class="kw">&lt;-</span> <span class="fu">testClusters</span>(<span class="no">locCor</span>, <span class="kw">FDR.cluster</span> <span class="kw">=</span> <span class="fl">0.1</span>)
<span class="no">clusters.trimmed</span> <span class="kw">&lt;-</span> <span class="fu">trimClusters</span>(<span class="no">clusters.rej</span>, <span class="kw">FDR.loc</span> <span class="kw">=</span> <span class="fl">0.05</span>)
<span class="no">DMRs</span> <span class="kw">&lt;-</span> <span class="fu">findDMRs</span>(<span class="no">clusters.trimmed</span>, <span class="kw">max.dist</span> <span class="kw">=</span> <span class="fl">100</span>, <span class="kw">diff.dir</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="no">DMRs.2</span> <span class="kw">&lt;-</span> <span class="fu">compareTwoSamples</span>(<span class="kw">object</span> <span class="kw">=</span> <span class="no">predictedMeth</span>, <span class="kw">sample1</span> <span class="kw">=</span> <span class="st">"C1"</span>,
    <span class="kw">sample2</span> <span class="kw">=</span> <span class="st">"S1"</span>, <span class="kw">minDiff</span> <span class="kw">=</span> <span class="fl">0.3</span>, <span class="kw">max.dist</span> <span class="kw">=</span> <span class="fl">100</span>)
<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="fu">overlapsAny</span>(<span class="no">DMRs.2</span>, <span class="no">DMRs</span>))</pre></body></html></div>
<div class="sourceCode" id="cb32"><html><body><pre class="r"><span class="no">rowCols</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"magenta"</span>, <span class="st">"blue"</span>)[<span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="fu">colData</span>(<span class="no">predictedMeth</span>)$<span class="no">group</span>)]
<span class="fu">plotMethMap</span>(<span class="no">predictedMeth</span>, <span class="kw">region</span> <span class="kw">=</span> <span class="no">DMRs</span>[<span class="fl">3</span>], <span class="kw">groups</span> <span class="kw">=</span> <span class="fu">colData</span>(<span class="no">predictedMeth</span>)$<span class="no">group</span>,
    <span class="kw">intervals</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">zlim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">1</span>), <span class="kw">RowSideColors</span> <span class="kw">=</span> <span class="no">rowCols</span>,
    <span class="kw">labCol</span> <span class="kw">=</span> <span class="st">""</span>, <span class="kw">margins</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">6</span>))</pre></body></html></div>
</div>
</div>
</div>
<div id="annotation-of-differentially-methylated-regions-dmrs" class="section level1">
<h1 class="hasAnchor">
<a href="#annotation-of-differentially-methylated-regions-dmrs" class="anchor"></a>Annotation of differentially methylated regions (DMRs)</h1>
<div id="annotation-with-genomation-package" class="section level2">
<h2 class="hasAnchor">
<a href="#annotation-with-genomation-package" class="anchor"></a>Annotation with <code>genomation</code> package</h2>
<p>differentially methylated regions/bas based on gene annotation using genomation package</p>
<div class="sourceCode" id="cb33"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"GenomicFeatures"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">BiocParallel</span>)
<span class="no">txdb</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/GenomicFeatures/man/makeTxDbFromGFF.html">makeTxDbFromGFF</a></span>(<span class="kw">file</span> <span class="kw">=</span> <span class="st">"data/TAIR10_GFF3_genes.gff"</span>,
    <span class="kw">format</span> <span class="kw">=</span> <span class="st">"gff"</span>, <span class="kw">dataSource</span> <span class="kw">=</span> <span class="st">"TAIR"</span>, <span class="kw">organism</span> <span class="kw">=</span> <span class="st">"Arabidopsis thaliana"</span>)
<span class="fu">saveDb</span>(<span class="no">txdb</span>, <span class="kw">file</span> <span class="kw">=</span> <span class="st">"./data/tair10.sqlite"</span>)
<span class="no">txdb</span> <span class="kw">&lt;-</span> <span class="fu">loadDb</span>(<span class="st">"./data/tair10.sqlite"</span>)
<span class="no">feat</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/systemPipeR/man/genFeatures.html">genFeatures</a></span>(<span class="no">txdb</span>, <span class="kw">featuretype</span> <span class="kw">=</span> <span class="st">"all"</span>, <span class="kw">reduce_ranges</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
    <span class="kw">upstream</span> <span class="kw">=</span> <span class="fl">1000</span>, <span class="kw">downstream</span> <span class="kw">=</span> <span class="fl">0</span>, <span class="kw">verbose</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="no">args</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/systemPipeR/man/systemArgs.html">systemArgs</a></span>(<span class="kw">sysma</span> <span class="kw">=</span> <span class="st">"param/bismark_aligner.param"</span>, <span class="kw">mytargets</span> <span class="kw">=</span> <span class="st">"targets_trim.txt"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">grid</span>)

<span class="no">path</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(), <span class="st">"/results"</span>, <span class="kw">sep</span> <span class="kw">=</span> <span class="st">""</span>)
<span class="no">report</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>()
<span class="no">file.list</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span>(<span class="no">path</span>, <span class="st">"*.out"</span>, <span class="kw">full.names</span> <span class="kw">=</span> <span class="fl">TRUE</span>))
<span class="no">report</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>()
<span class="kw">for</span> (<span class="no">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="kw">along</span> <span class="kw">=</span> <span class="no">file.list</span>)) {
    <span class="no">file.list1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="no">file.list</span>[<span class="no">i</span>]), <span class="st">"*.bam"</span>,
        <span class="kw">full.names</span> <span class="kw">=</span> <span class="fl">TRUE</span>))
    <span class="no">report</span>[<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">report</span>) + <span class="fl">1</span>] <span class="kw">&lt;-</span> <span class="no">file.list1</span>
}

<span class="no">fc</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/systemPipeR/man/featuretypeCounts.html">featuretypeCounts</a></span>(<span class="kw">bfl</span> <span class="kw">=</span> <span class="fu">BamFileList</span>(<span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="no">report</span>),
    <span class="kw">yieldSize</span> <span class="kw">=</span> <span class="fl">50000</span>), <span class="kw">grl</span> <span class="kw">=</span> <span class="no">feat</span>, <span class="kw">singleEnd</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">readlength</span> <span class="kw">=</span> <span class="kw">NULL</span>,
    <span class="kw">type</span> <span class="kw">=</span> <span class="st">"data.frame"</span>)

<span class="no">p</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/systemPipeR/man/plotfeaturetypeCounts.html">plotfeaturetypeCounts</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">fc</span>, <span class="kw">graphicsfile</span> <span class="kw">=</span> <span class="st">"results/featureCounts.png"</span>,
    <span class="kw">graphicsformat</span> <span class="kw">=</span> <span class="st">"png"</span>, <span class="kw">scales</span> <span class="kw">=</span> <span class="st">"fixed"</span>, <span class="kw">anyreadlength</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
    <span class="kw">scale_length_val</span> <span class="kw">=</span> <span class="kw">NULL</span>)

<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">genomation</span>)</pre></body></html></div>
</div>
<div id="annotation-with-chippeakanno-package" class="section level2">
<h2 class="hasAnchor">
<a href="#annotation-with-chippeakanno-package" class="anchor"></a>Annotation with <code>ChIPpeakAnno</code> package</h2>
<p>The following annotates the DMR with genomic context information using the <code>ChIPpeakAnno</code> package <span class="citation">(Zhu et al. 2010)</span>.</p>
<div class="sourceCode" id="cb34"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ChIPpeakAnno</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">GenomicFeatures</span>)
<span class="no">args</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/systemPipeR/man/systemArgs.html">systemArgs</a></span>(<span class="kw">sysma</span> <span class="kw">=</span> <span class="st">"param/annotate_peaks.param"</span>, <span class="kw">mytargets</span> <span class="kw">=</span> <span class="st">"targets_macs.txt"</span>)
<span class="co"># txdb &lt;- loadDb('./data/tair10.sqlite')</span>
<span class="no">txdb</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/GenomicFeatures/man/makeTxDbFromGFF.html">makeTxDbFromGFF</a></span>(<span class="kw">file</span> <span class="kw">=</span> <span class="st">"data/TAIR10_GFF3_genes.gff"</span>,
    <span class="kw">format</span> <span class="kw">=</span> <span class="st">"gff"</span>, <span class="kw">dataSource</span> <span class="kw">=</span> <span class="st">"TAIR"</span>, <span class="kw">organism</span> <span class="kw">=</span> <span class="st">"Arabidopsis thaliana"</span>)
<span class="no">ge</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/GenomicFeatures/man/transcripts.html">genes</a></span>(<span class="no">txdb</span>, <span class="kw">columns</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"tx_name"</span>, <span class="st">"gene_id"</span>, <span class="st">"tx_type"</span>))

<span class="kw">for</span> (<span class="no">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="kw">along</span> <span class="kw">=</span> <span class="no">args</span>)) {
    <span class="no">peaksGR</span> <span class="kw">&lt;-</span> <span class="fu">as</span>(<span class="no">merged_samples</span>, <span class="st">"GRanges"</span>)
    <span class="no">annotatedPeak</span> <span class="kw">&lt;-</span> <span class="fu">annotatePeakInBatch</span>(<span class="no">peaksGR</span>, <span class="kw">AnnotationData</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/GenomicFeatures/man/transcripts.html">genes</a></span>(<span class="no">txdb</span>))
    <span class="no">df</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>(<span class="no">annotatedPeak</span>), <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>(<span class="fu">values</span>(<span class="no">ge</span>[<span class="fu">values</span>(<span class="no">annotatedPeak</span>)$<span class="no">feature</span>,
        ])))
    <span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.table</a></span>(<span class="no">df</span>, <span class="fu"><a href="https://rdrr.io/pkg/systemPipeR/man/sysargs.html">outpaths</a></span>(<span class="no">args</span>[<span class="no">i</span>]), <span class="kw">quote</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">row.names</span> <span class="kw">=</span> <span class="fl">FALSE</span>,
        <span class="kw">sep</span> <span class="kw">=</span> <span class="st">"\t"</span>)
}
<span class="fu"><a href="https://rdrr.io/pkg/systemPipeR/man/writeTargetsout.html">writeTargetsout</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">args</span>, <span class="kw">file</span> <span class="kw">=</span> <span class="st">"targets_peakanno.txt"</span>, <span class="kw">overwrite</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
</div>
</div>
<div id="version-information" class="section level1">
<h1 class="hasAnchor">
<a href="#version-information" class="anchor"></a>Version Information</h1>
<div class="sourceCode" id="cb35"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html">sessionInfo</a></span>()</pre></body></html></div>
<pre><code>## R Under development (unstable) (2020-03-31 r78116)
## Platform: x86_64-pc-linux-gnu (64-bit)
## Running under: Ubuntu 20.04 LTS
## 
## Matrix products: default
## BLAS:   /usr/local/lib/R/lib/libRblas.so
## LAPACK: /usr/local/lib/R/lib/libRlapack.so
## 
## locale:
##  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              
##  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    
##  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   
##  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 
##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            
## [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       
## 
## attached base packages:
## [1] stats4    parallel  stats     graphics  grDevices
## [6] utils     datasets  methods   base     
## 
## other attached packages:
##  [1] ape_5.3                     ggplot2_3.3.0              
##  [3] batchtools_0.9.13           systemPipeR_1.21.9         
##  [5] ShortRead_1.45.4            GenomicAlignments_1.23.2   
##  [7] SummarizedExperiment_1.17.5 DelayedArray_0.13.12       
##  [9] matrixStats_0.56.0          Biobase_2.47.3             
## [11] BiocParallel_1.21.3         Rsamtools_2.3.7            
## [13] Biostrings_2.55.7           XVector_0.27.2             
## [15] GenomicRanges_1.39.3        GenomeInfoDb_1.23.17       
## [17] IRanges_2.21.8              S4Vectors_0.25.15          
## [19] BiocGenerics_0.33.3         BiocStyle_2.15.8           
## 
## loaded via a namespace (and not attached):
##   [1] colorspace_1.4-1         rjson_0.2.20            
##   [3] hwriter_1.3.2            ellipsis_0.3.0          
##   [5] rprojroot_1.3-2          fs_1.4.1                
##   [7] bit64_0.9-7              AnnotationDbi_1.49.1    
##   [9] codetools_0.2-16         splines_4.1.0           
##  [11] knitr_1.28               annotate_1.65.1         
##  [13] GO.db_3.10.0             dbplyr_1.4.3            
##  [15] png_0.1-7                pheatmap_1.0.12         
##  [17] graph_1.65.3             BiocManager_1.30.10     
##  [19] compiler_4.1.0           httr_1.4.1              
##  [21] GOstats_2.53.0           backports_1.1.6         
##  [23] assertthat_0.2.1         Matrix_1.2-18           
##  [25] limma_3.43.8             formatR_1.7             
##  [27] htmltools_0.4.0          prettyunits_1.1.1       
##  [29] tools_4.1.0              gtable_0.3.0            
##  [31] glue_1.4.0               GenomeInfoDbData_1.2.3  
##  [33] Category_2.53.1          dplyr_0.8.5             
##  [35] rappdirs_0.3.1           Rcpp_1.0.4.6            
##  [37] pkgdown_1.5.1            vctrs_0.2.4             
##  [39] nlme_3.1-145             rtracklayer_1.47.0      
##  [41] xfun_0.13                stringr_1.4.0           
##  [43] lifecycle_0.2.0          XML_3.99-0.3            
##  [45] edgeR_3.29.1             zlibbioc_1.33.1         
##  [47] MASS_7.3-51.5            scales_1.1.0            
##  [49] BSgenome_1.55.4          VariantAnnotation_1.33.4
##  [51] hms_0.5.3                RBGL_1.63.1             
##  [53] RColorBrewer_1.1-2       yaml_2.2.1              
##  [55] curl_4.3                 memoise_1.1.0           
##  [57] biomaRt_2.43.6           latticeExtra_0.6-29     
##  [59] stringi_1.4.6            RSQLite_2.2.0           
##  [61] genefilter_1.69.0        desc_1.2.0              
##  [63] checkmate_2.0.0          GenomicFeatures_1.39.7  
##  [65] rlang_0.4.5              pkgconfig_2.0.3         
##  [67] bitops_1.0-6             evaluate_0.14           
##  [69] lattice_0.20-40          purrr_0.3.4             
##  [71] bit_1.1-15.2             tidyselect_1.0.0        
##  [73] GSEABase_1.49.1          AnnotationForge_1.29.3  
##  [75] magrittr_1.5             bookdown_0.18           
##  [77] R6_2.4.1                 base64url_1.4           
##  [79] DBI_1.1.0                pillar_1.4.3            
##  [81] withr_2.2.0              survival_3.1-11         
##  [83] RCurl_1.98-1.2           tibble_3.0.1            
##  [85] crayon_1.3.4             BiocFileCache_1.11.6    
##  [87] rmarkdown_2.1            jpeg_0.1-8.1            
##  [89] progress_1.2.2           locfit_1.5-9.4          
##  [91] grid_4.1.0               data.table_1.12.8       
##  [93] blob_1.2.1               Rgraphviz_2.31.0        
##  [95] digest_0.6.25            xtable_1.8-4            
##  [97] brew_1.0-6               openssl_1.4.1           
##  [99] munsell_0.5.0            askpass_1.1</code></pre>
</div>
<div id="funding" class="section level1">
<h1 class="hasAnchor">
<a href="#funding" class="anchor"></a>Funding</h1>
<p>This project was supported by funds from the National Institutes of Health (NIH) and the National Science Foundation (NSF).</p>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-Ganguly2017-ur">
<p>Ganguly, Diep R, Peter A Crisp, Steven R Eichten, and Barry J Pogson. 2017. “The Arabidopsis DNA Methylome Is Stable Under Transgenerational Drought Stress.” <em>Plant Physiol.</em> 175 (4): 1893–1912.</p>
</div>
<div id="ref-Girke2014-oy">
<p>Girke, Thomas. 2014. “systemPipeR: NGS Workflow and Report Generation Environment.” UC Riverside. <a href="https://github.com/tgirke/systemPipeR">https://github.com/tgirke/systemPipeR</a>.</p>
</div>
<div id="ref-biseq">
<p>Hebestreit, Katja, and Hans-Ulrich Klein. 2015. <em>BiSeq: Processing and Analyzing Bisulfite Sequencing Data</em>.</p>
</div>
<div id="ref-Krueger2011-uu">
<p>Krueger, Felix, and Simon R Andrews. 2011. “Bismark: A Flexible Aligner and Methylation Caller for Bisulfite-Seq Applications.” <em>Bioinformatics</em> 27 (11): 1571–2.</p>
</div>
<div id="ref-Langmead2012-bs">
<p>Langmead, Ben, and Steven L Salzberg. 2012. “Fast Gapped-Read Alignment with Bowtie 2.” <em>Nat. Methods</em> 9 (4): 357–59. <a href="https://doi.org/10.1038/nmeth.1923">https://doi.org/10.1038/nmeth.1923</a>.</p>
</div>
<div id="ref-Zhu2010-zo">
<p>Zhu, Lihua J, Claude Gazin, Nathan D Lawson, Hervé Pagès, Simon M Lin, David S Lapointe, and Michael R Green. 2010. “ChIPpeakAnno: A Bioconductor Package to Annotate ChIP-seq and ChIP-chip Data.” <em>BMC Bioinformatics</em> 11: 237. <a href="https://doi.org/10.1186/1471-2105-11-237">https://doi.org/10.1186/1471-2105-11-237</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://www.dcassol.com/">Daniela Cassol</a>, <a href="http://girke.bioinformatics.ucr.edu/">Thomas Girke</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '',
    indexName: '',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
